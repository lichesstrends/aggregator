services:
  dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    working_dir: /app
    env_file:
      - .env
    environment:
      # ensure cargo/binaries are on PATH even in non-login shells
      PATH: "/usr/local/cargo/bin:/usr/local/rustup/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
    volumes:
      - .:/app
      - ./data:/data
      - cargo-registry:/usr/local/cargo/registry
      - cargo-git:/usr/local/cargo/git
      - target-cache:/app/target
    tty: true
    # keep container alive; dev.sh will run the compiled binary
    command: ["bash", "-lc", "sleep infinity"]

  # SQLite web UI (harmless if you use Neon; it just serves ./data/lichess.db)
  dbui:
    image: coleifer/sqlite-web:latest
    command: ["sqlite_web", "-H", "0.0.0.0", "-p", "8080", "/data/lichess.db"]
    ports:
      - "8080:8080"
    volumes:
      - ./data:/data

volumes:
  cargo-registry:
  cargo-git:
  target-cache:
